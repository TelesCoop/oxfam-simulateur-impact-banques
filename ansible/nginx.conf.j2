{{ ansible_managed | comment }}

server {

    listen 80;

    server_name {{ public_hostname }};

    access_log /var/log/nginx/access_{{ public_hostname.replace('.', '_') }}.log;
    error_log /var/log/nginx/error_{{ public_hostname.replace('.', '_') }}.log;

    # http://stackoverflow.com/questions/15238506/djangos-suspiciousoperation-invalid-http-host-header
    # Deny illegal Host headers
    if ($host !~* ^({{ public_hostname }})$ ) {
        return 444;
    }

    location =/entry {
        return 204;
    }

    location / {
        root {{ static_path }};
    }
}
