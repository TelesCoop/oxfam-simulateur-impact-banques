{{ ansible_managed | comment }}

server {

    listen 80;

    server_name {{ public_hostname }};

    access_log {{ logs_base_path }}/access_impact_banques.log;
    error_log {{ logs_base_path }}/error_impact_banques.log;

    # http://stackoverflow.com/questions/15238506/djangos-suspiciousoperation-invalid-http-host-header
    # Deny illegal Host headers
    if ($host !~* ^({{ public_hostname }})$ ) {
        return 444;
    }

    location =/entry {
        add_header Access-Control-Allow-Origin https://www.oxfamfrance.org/;
        return 204;
    }

    location / {
        root {{ static_path }};
    }
}
